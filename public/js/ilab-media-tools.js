!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function e(t){return"number"==typeof t&&!isNaN(t)}function i(t){return"undefined"==typeof t}function a(t,i){var a=[];return e(i)&&a.push(i),a.slice.apply(t,a)}function s(t,e){var i=a(arguments,2);return function(){return t.apply(e,i.concat(a(arguments)))}}function n(t){var e=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return e&&(e[1]!==u.protocol||e[2]!==u.hostname||e[3]!==u.port)}function o(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e}function r(t){var i=[],a=t.rotate,s=t.scaleX,n=t.scaleY;return e(a)&&i.push("rotate("+a+"deg)"),e(s)&&e(n)&&i.push("scale("+s+","+n+")"),i.length?i.join(" "):"none"}function h(t,e){var i,a,s=et(t.degree)%180,n=(s>90?180-s:s)*Math.PI/180,o=it(n),r=at(n),h=t.width,l=t.height,d=t.aspectRatio;return e?(i=h/(r+o/d),a=i/d):(i=h*r+l*o,a=h*o+l*r),{width:i,height:a}}function l(i,a){var s,n,o,r=t("<canvas>")[0],l=r.getContext("2d"),d=0,p=0,c=a.naturalWidth,u=a.naturalHeight,m=a.rotate,g=a.scaleX,f=a.scaleY,v=e(g)&&e(f)&&(1!==g||1!==f),x=e(m)&&0!==m,b=x||v,w=c,C=u;return v&&(s=c/2,n=u/2),x&&(o=h({width:c,height:u,degree:m}),w=o.width,C=o.height,s=o.width/2,n=o.height/2),r.width=w,r.height=C,b&&(d=-c/2,p=-u/2,l.save(),l.translate(s,n)),x&&l.rotate(m*Math.PI/180),v&&l.scale(g,f),l.drawImage(i,d,p,c,u),b&&l.restore(),r}function d(e,i){this.$element=t(e),this.options=t.extend({},d.DEFAULTS,t.isPlainObject(i)&&i),this.ready=!1,this.built=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var p=t(window),c=t(document),u=window.location,m="cropper",g="preview."+m,f="cropper-modal",v="cropper-hide",x="cropper-hidden",b="cropper-invisible",w="cropper-move",C="cropper-crop",y="cropper-disabled",I="cropper-bg",k="mousedown touchstart pointerdown MSPointerDown",B="mousemove touchmove pointermove MSPointerMove",P="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",S="wheel mousewheel DOMMouseScroll",_="dblclick",D="resize."+m,$="build."+m,T="built."+m,L="cropstart."+m,M="cropmove."+m,W="cropend."+m,z="crop."+m,H="zoom."+m,O=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,j="e",E="w",Y="s",R="n",X="se",A="sw",F="ne",V="nw",U="all",N="crop",Q="move",Z="zoom",q="none",K=t.isFunction(t("<canvas>")[0].getContext),J=Math.sqrt,G=Math.min,tt=Math.max,et=Math.abs,it=Math.sin,at=Math.cos,st=parseFloat,nt={};t.extend(nt,{init:function(){var t,e=this.$element;if(e.is("img")){if(this.isImg=!0,this.originalUrl=t=e.attr("src"),!t)return;t=e.prop("src")}else e.is("canvas")&&K&&(t=e[0].toDataURL());this.load(t)},trigger:function(e,i){var a=t.Event(e,i);return this.$element.trigger(a),a.isDefaultPrevented()},load:function(e){var i,a,s=this.options,r=this.$element,h="";e&&(r.one($,s.build),this.trigger($)||(s.checkImageOrigin&&n(e)&&(h=' crossOrigin="anonymous"',r.prop("crossOrigin")||(i=o(e))),this.$clone=a=t("<img"+h+' src="'+(i||e)+'">'),a.one("load",t.proxy(function(){var t=a[0],i=t.naturalWidth||t.width,s=t.naturalHeight||t.height;this.image={naturalWidth:i,naturalHeight:s,aspectRatio:i/s},this.url=e,this.ready=!0,this.build()},this)).one("error",function(){a.remove()}),a.addClass(v).insertAfter(r)))}}),t.extend(nt,{build:function(){var e,i,a,s=this.options,n=this.$element,o=this.$clone;this.ready&&(this.built&&this.unbuild(),this.$cropper=e=t(d.TEMPLATE),n.addClass(x),o.removeClass(v),this.$container=n.parent().append(e),this.$canvas=e.find(".cropper-canvas").append(o),this.$dragBox=e.find(".cropper-drag-box"),this.$cropBox=i=e.find(".cropper-crop-box"),this.$viewBox=e.find(".cropper-view-box"),this.$face=a=i.find(".cropper-face"),this.initPreview(),this.bind(),s.aspectRatio=st(s.aspectRatio)||NaN,s.autoCrop?(this.cropped=!0,s.modal&&this.$dragBox.addClass(f)):i.addClass(x),s.guides||i.find(".cropper-dashed").addClass(x),s.center||i.find(".cropper-center").addClass(x),s.cropBoxMovable&&a.addClass(w).data("action",U),s.highlight||a.addClass(b),s.background&&e.addClass(I),s.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(x),this.setDragMode(s.dragCrop?N:s.movable?Q:q),this.built=!0,this.render(),this.setData(s.data),n.one(T,s.built),this.trigger(T))},unbuild:function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(nt,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.options,e=this.$element,i=this.$container,a=this.$cropper;a.addClass(x),e.removeClass(x),a.css(this.container={width:tt(i.width(),st(t.minContainerWidth)||200),height:tt(i.height(),st(t.minContainerHeight)||100)}),e.addClass(x),a.removeClass(x)},initCanvas:function(){var e=this.container,i=e.width,a=e.height,s=this.image,n=s.aspectRatio,o={aspectRatio:n,width:i,height:a};a*n>i?o.height=i/n:o.width=a*n,o.oldLeft=o.left=(i-o.width)/2,o.oldTop=o.top=(a-o.height)/2,this.canvas=o,this.limitCanvas(!0,!0),this.initialImage=t.extend({},s),this.initialCanvas=t.extend({},o)},limitCanvas:function(e,i){var a,s,n=this.options,o=n.strict,r=this.container,h=r.width,l=r.height,d=this.canvas,p=d.aspectRatio,c=this.cropBox,u=this.cropped&&c,m=this.initialCanvas||d,g=m.width,f=m.height;e&&(a=st(n.minCanvasWidth)||0,s=st(n.minCanvasHeight)||0,a?(o&&(a=tt(u?c.width:g,a)),s=a/p):s?(o&&(s=tt(u?c.height:f,s)),a=s*p):o&&(u?(a=c.width,s=c.height,s*p>a?a=s*p:s=a/p):(a=g,s=f)),t.extend(d,{minWidth:a,minHeight:s,maxWidth:1/0,maxHeight:1/0})),i&&(o?u?(d.minLeft=G(c.left,c.left+c.width-d.width),d.minTop=G(c.top,c.top+c.height-d.height),d.maxLeft=c.left,d.maxTop=c.top):(d.minLeft=G(0,h-d.width),d.minTop=G(0,l-d.height),d.maxLeft=tt(0,h-d.width),d.maxTop=tt(0,l-d.height)):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=h,d.maxTop=l))},renderCanvas:function(t){var e,i,a=this.options,s=this.canvas,n=this.image;this.rotated&&(this.rotated=!1,i=h({width:n.width,height:n.height,degree:n.rotate}),e=i.width/i.height,e!==s.aspectRatio&&(s.left-=(i.width-s.width)/2,s.top-=(i.height-s.height)/2,s.width=i.width,s.height=i.height,s.aspectRatio=e,this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=G(tt(s.width,s.minWidth),s.maxWidth),s.height=G(tt(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=G(tt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=G(tt(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.cropped&&a.strict&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(e){var i,a=this.canvas,s=this.image;s.rotate&&(i=h({width:a.width,height:a.height,degree:s.rotate,aspectRatio:s.aspectRatio},!0)),t.extend(s,i?{width:i.width,height:i.height,left:(a.width-i.width)/2,top:(a.height-i.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:s.width,height:s.height,marginLeft:s.left,marginTop:s.top,transform:r(s)}),e&&this.output()},initCropBox:function(){var e=this.options,i=this.canvas,a=e.aspectRatio,s=st(e.autoCropArea)||.8,n={width:i.width,height:i.height};a&&(i.height*a>i.width?n.height=n.width/a:n.width=n.height*a),this.cropBox=n,this.limitCropBox(!0,!0),n.width=G(tt(n.width,n.minWidth),n.maxWidth),n.height=G(tt(n.height,n.minHeight),n.maxHeight),n.width=tt(n.minWidth,n.width*s),n.height=tt(n.minHeight,n.height*s),n.oldLeft=n.left=i.left+(i.width-n.width)/2,n.oldTop=n.top=i.top+(i.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,e){var i,a,s=this.options,n=s.strict,o=this.container,r=o.width,h=o.height,l=this.canvas,d=this.cropBox,p=s.aspectRatio;t&&(i=st(s.minCropBoxWidth)||0,a=st(s.minCropBoxHeight)||0,d.minWidth=G(r,i),d.minHeight=G(h,a),d.maxWidth=G(r,n?l.width:r),d.maxHeight=G(h,n?l.height:h),p&&(d.maxHeight*p>d.maxWidth?(d.minHeight=d.minWidth/p,d.maxHeight=d.maxWidth/p):(d.minWidth=d.minHeight*p,d.maxWidth=d.maxHeight*p)),d.minWidth=G(d.maxWidth,d.minWidth),d.minHeight=G(d.maxHeight,d.minHeight)),e&&(n?(d.minLeft=tt(0,l.left),d.minTop=tt(0,l.top),d.maxLeft=G(r,l.left+l.width)-d.width,d.maxTop=G(h,l.top+l.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=r-d.width,d.maxTop=h-d.height))},renderCropBox:function(){var t=this.options,e=this.container,i=e.width,a=e.height,s=this.cropBox;(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=G(tt(s.width,s.minWidth),s.maxWidth),s.height=G(tt(s.height,s.minHeight),s.maxHeight),this.limitCropBox(!1,!0),s.oldLeft=s.left=G(tt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=G(tt(s.top,s.minTop),s.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("action",s.width===i&&s.height===a?Q:U),this.$cropBox.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.cropped&&t.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.trigger(z,this.getData())}}),t.extend(nt,{initPreview:function(){var e=this.url;this.$preview=t(this.options.preview),this.$viewBox.html('<img src="'+e+'">'),this.$preview.each(function(){var i=t(this);i.data(g,{width:i.width(),height:i.height(),original:i.html()}),i.html('<img src="'+e+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important">')})},resetPreview:function(){this.$preview.each(function(){var e=t(this);e.html(e.data(g).original).removeData(g)})},preview:function(){var e=this.image,i=this.canvas,a=this.cropBox,s=e.width,n=e.height,o=a.left-i.left-e.left,h=a.top-i.top-e.top;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:s,height:n,marginLeft:-o,marginTop:-h,transform:r(e)}),this.$preview.each(function(){var i=t(this),l=i.data(g),d=l.width/a.width,p=l.width,c=a.height*d;c>l.height&&(d=l.height/a.height,p=a.width*d,c=l.height),i.width(p).height(c).find("img").css({width:s*d,height:n*d,marginLeft:-o*d,marginTop:-h*d,transform:r(e)})}))}}),t.extend(nt,{bind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.on(L,e.cropstart),t.isFunction(e.cropmove)&&i.on(M,e.cropmove),t.isFunction(e.cropend)&&i.on(W,e.cropend),t.isFunction(e.crop)&&i.on(z,e.crop),t.isFunction(e.zoom)&&i.on(H,e.zoom),a.on(k,t.proxy(this.cropStart,this)),e.zoomable&&e.mouseWheelZoom&&a.on(S,t.proxy(this.wheel,this)),e.doubleClickToggle&&a.on(_,t.proxy(this.dblclick,this)),c.on(B,this._cropMove=s(this.cropMove,this)).on(P,this._cropEnd=s(this.cropEnd,this)),e.responsive&&p.on(D,this._resize=s(this.resize,this))},unbind:function(){var e=this.options,i=this.$element,a=this.$cropper;t.isFunction(e.cropstart)&&i.off(L,e.cropstart),t.isFunction(e.cropmove)&&i.off(M,e.cropmove),t.isFunction(e.cropend)&&i.off(W,e.cropend),t.isFunction(e.crop)&&i.off(z,e.crop),t.isFunction(e.zoom)&&i.off(H,e.zoom),a.off(k,this.cropStart),e.zoomable&&e.mouseWheelZoom&&a.off(S,this.wheel),e.doubleClickToggle&&a.off(_,this.dblclick),c.off(B,this._cropMove).off(P,this._cropEnd),e.responsive&&p.off(D,this._resize)}}),t.extend(nt,{resize:function(){var e,i,a,s=this.$container,n=this.container;!this.disabled&&n&&(a=s.width()/n.width,1===a&&s.height()===n.height||(e=this.getCanvasData(),i=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(e,function(t,i){e[t]=i*a})),this.setCropBoxData(t.each(i,function(t,e){i[t]=e*a}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(C)?this.setDragMode(Q):this.setDragMode(N))},wheel:function(t){var e=t.originalEvent,i=e,a=st(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),i.deltaY?s=i.deltaY>0?1:-1:i.wheelDelta?s=-i.wheelDelta/120:i.detail&&(s=i.detail>0?1:-1),this.zoom(-s*a,e))},cropStart:function(e){var i,a,s=this.options,n=e.originalEvent,o=n&&n.touches,r=n||e;if(!this.disabled){if(o){if(i=o.length,i>1){if(!s.zoomable||!s.touchDragZoom||2!==i)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,a=Z}r=o[0]}if(a=a||t(r.target).data("action"),O.test(a)){if(this.trigger(L,{originalEvent:n,action:a}))return;e.preventDefault(),this.action=a,this.cropping=!1,this.startX=r.pageX,this.startY=r.pageY,a===N&&(this.cropping=!0,this.$dragBox.addClass(f))}}},cropMove:function(t){var e,i=this.options,a=t.originalEvent,s=a&&a.touches,n=a||t,o=this.action;if(!this.disabled){if(s){if(e=s.length,e>1){if(!i.zoomable||!i.touchDragZoom||2!==e)return;n=s[1],this.endX2=n.pageX,this.endY2=n.pageY}n=s[0]}if(o){if(this.trigger(M,{originalEvent:a,action:o}))return;t.preventDefault(),this.endX=n.pageX,this.endY=n.pageY,this.change(n.shiftKey,o===Z?a:null)}}},cropEnd:function(t){var e=t.originalEvent,i=this.action;this.disabled||i&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(f,this.cropped&&this.options.modal)),this.action="",this.trigger(W,{originalEvent:e,action:i}))}}),t.extend(nt,{change:function(t,e){var i,a,s=this.options,n=s.aspectRatio,o=this.action,r=this.container,h=this.canvas,l=this.cropBox,d=l.width,p=l.height,c=l.left,u=l.top,m=c+d,g=u+p,f=0,v=0,b=r.width,w=r.height,C=!0;switch(!n&&t&&(n=d&&p?d/p:1),s.strict&&(f=l.minLeft,v=l.minTop,b=f+G(r.width,h.width),w=v+G(r.height,h.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},n&&(a.X=a.y*n,a.Y=a.x/n),o){case U:c+=a.x,u+=a.y;break;case j:if(a.x>=0&&(m>=b||n&&(v>=u||g>=w))){C=!1;break}d+=a.x,n&&(p=d/n,u-=a.Y/2),0>d&&(o=E,d=0);break;case R:if(a.y<=0&&(v>=u||n&&(f>=c||m>=b))){C=!1;break}p-=a.y,u+=a.y,n&&(d=p*n,c+=a.X/2),0>p&&(o=Y,p=0);break;case E:if(a.x<=0&&(f>=c||n&&(v>=u||g>=w))){C=!1;break}d-=a.x,c+=a.x,n&&(p=d/n,u+=a.Y/2),0>d&&(o=j,d=0);break;case Y:if(a.y>=0&&(g>=w||n&&(f>=c||m>=b))){C=!1;break}p+=a.y,n&&(d=p*n,c-=a.X/2),0>p&&(o=R,p=0);break;case F:if(n){if(a.y<=0&&(v>=u||m>=b)){C=!1;break}p-=a.y,u+=a.y,d=p*n}else a.x>=0?b>m?d+=a.x:a.y<=0&&v>=u&&(C=!1):d+=a.x,a.y<=0?u>v&&(p-=a.y,u+=a.y):(p-=a.y,u+=a.y);0>d&&0>p?(o=A,p=0,d=0):0>d?(o=V,d=0):0>p&&(o=X,p=0);break;case V:if(n){if(a.y<=0&&(v>=u||f>=c)){C=!1;break}p-=a.y,u+=a.y,d=p*n,c+=a.X}else a.x<=0?c>f?(d-=a.x,c+=a.x):a.y<=0&&v>=u&&(C=!1):(d-=a.x,c+=a.x),a.y<=0?u>v&&(p-=a.y,u+=a.y):(p-=a.y,u+=a.y);0>d&&0>p?(o=X,p=0,d=0):0>d?(o=F,d=0):0>p&&(o=A,p=0);break;case A:if(n){if(a.x<=0&&(f>=c||g>=w)){C=!1;break}d-=a.x,c+=a.x,p=d/n}else a.x<=0?c>f?(d-=a.x,c+=a.x):a.y>=0&&g>=w&&(C=!1):(d-=a.x,c+=a.x),a.y>=0?w>g&&(p+=a.y):p+=a.y;0>d&&0>p?(o=F,p=0,d=0):0>d?(o=X,d=0):0>p&&(o=V,p=0);break;case X:if(n){if(a.x>=0&&(m>=b||g>=w)){C=!1;break}d+=a.x,p=d/n}else a.x>=0?b>m?d+=a.x:a.y>=0&&g>=w&&(C=!1):d+=a.x,a.y>=0?w>g&&(p+=a.y):p+=a.y;0>d&&0>p?(o=V,p=0,d=0):0>d?(o=A,d=0):0>p&&(o=F,p=0);break;case Q:h.left+=a.x,h.top+=a.y,this.renderCanvas(!0),C=!1;break;case Z:this.zoom(function(t,e,i,a){var s=J(t*t+e*e),n=J(i*i+a*a);return(n-s)/s}(et(this.startX-this.startX2),et(this.startY-this.startY2),et(this.endX-this.endX2),et(this.endY-this.endY2)),e),this.startX2=this.endX2,this.startY2=this.endY2,C=!1;break;case N:a.x&&a.y&&(i=this.$cropper.offset(),c=this.startX-i.left,u=this.startY-i.top,d=l.minWidth,p=l.minHeight,a.x>0?a.y>0?o=X:(o=F,u-=p):a.y>0?(o=A,c-=d):(o=V,c-=d,u-=p),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(x)))}C&&(l.width=d,l.height=p,l.left=c,l.top=u,this.action=o,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(nt,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(f),this.$cropBox.removeClass(x)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(f),this.$cropBox.addClass(x))},replace:function(t){!this.disabled&&t&&(this.isImg&&this.$element.attr("src",t),this.options.data=null,this.load(t))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(y))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(y))},destroy:function(){var t=this.$element;this.ready?(this.isImg&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(x)):this.$clone&&this.$clone.remove(),t.removeData(m)},move:function(t,a){var s=this.canvas;i(a)&&(a=t),t=st(t),a=st(a),this.built&&!this.disabled&&this.options.movable&&(s.left+=e(t)?t:0,s.top+=e(a)?a:0,this.renderCanvas(!0))},zoom:function(t,e){var i,a,s=this.canvas;if(t=st(t),t&&this.built&&!this.disabled&&this.options.zoomable){if(this.trigger(H,{originalEvent:e,ratio:t}))return;t=0>t?1/(1-t):1+t,i=s.width*t,a=s.height*t,s.left-=(i-s.width)/2,s.top-=(a-s.height)/2,s.width=i,s.height=a,this.renderCanvas(!0),this.setDragMode(Q)}},rotate:function(t){var e=this.image,i=e.rotate||0;t=st(t)||0,this.built&&!this.disabled&&this.options.rotatable&&(e.rotate=(i+t)%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(t,a){var s=this.image;i(a)&&(a=t),t=st(t),a=st(a),this.built&&!this.disabled&&this.options.scalable&&(s.scaleX=e(t)?t:1,s.scaleY=e(a)?a:1,this.renderImage(!0))},getData:function(e){var i,a,s=this.options,n=this.image,o=this.canvas,r=this.cropBox;return this.built&&this.cropped?(a={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height},i=n.width/n.naturalWidth,t.each(a,function(t,s){s/=i,a[t]=e?Math.round(s):s})):a={x:0,y:0,width:0,height:0},s.rotatable&&(a.rotate=n.rotate||0),s.scalable&&(a.scaleX=n.scaleX||1,a.scaleY=n.scaleY||1),a},setData:function(i){var a,s=this.image,n=this.canvas,o={};t.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&t.isPlainObject(i)&&(e(i.rotate)&&i.rotate!==s.rotate&&this.options.rotatable&&(s.rotate=i.rotate,this.rotated=!0,this.renderCanvas(!0)),a=s.width/s.naturalWidth,e(i.x)&&(o.left=i.x*a+n.left),e(i.y)&&(o.top=i.y*a+n.top),e(i.width)&&(o.width=i.width*a),e(i.height)&&(o.height=i.height*a),this.setCropBoxData(o))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var t,e=this.canvas;return this.built&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCanvasData:function(i){var a=this.canvas,s=a.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&t.isPlainObject(i)&&(e(i.left)&&(a.left=i.left),e(i.top)&&(a.top=i.top),e(i.width)?(a.width=i.width,a.height=i.width/s):e(i.height)&&(a.height=i.height,a.width=i.height*s),this.renderCanvas(!0))},getCropBoxData:function(){var t,e=this.cropBox;return this.built&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(i){var a,s,n=this.cropBox,o=this.options.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.built&&this.cropped&&!this.disabled&&t.isPlainObject(i)&&(e(i.left)&&(n.left=i.left),e(i.top)&&(n.top=i.top),e(i.width)&&i.width!==n.width&&(a=!0,n.width=i.width),e(i.height)&&i.height!==n.height&&(s=!0,n.height=i.height),o&&(a?n.height=n.width/o:s&&(n.width=n.height*o)),this.renderCropBox())},getCroppedCanvas:function(e){var i,a,s,n,o,r,h,d,p,c,u;return this.built&&this.cropped&&K?(t.isPlainObject(e)||(e={}),u=this.getData(),i=u.width,a=u.height,d=i/a,t.isPlainObject(e)&&(o=e.width,r=e.height,o?(r=o/d,h=o/i):r&&(o=r*d,h=r/a)),s=o||i,n=r||a,p=t("<canvas>")[0],p.width=s,p.height=n,c=p.getContext("2d"),e.fillColor&&(c.fillStyle=e.fillColor,c.fillRect(0,0,s,n)),c.drawImage.apply(c,function(){var t,e,s,n,o,r,d=l(this.$clone[0],this.image),p=d.width,c=d.height,m=[d],g=u.x,f=u.y;return-i>=g||g>p?g=t=s=o=0:0>=g?(s=-g,g=0,t=o=G(p,i+g)):p>=g&&(s=0,t=o=G(i,p-g)),0>=t||-a>=f||f>c?f=e=n=r=0:0>=f?(n=-f,f=0,e=r=G(c,a+f)):c>=f&&(n=0,e=r=G(a,c-f)),m.push(g,f,t,e),h&&(s*=h,n*=h,o*=h,r*=h),o>0&&r>0&&m.push(s,n,o,r),m}.call(this)),p):void 0},setAspectRatio:function(t){var e=this.options;this.disabled||i(t)||(e.aspectRatio=st(t)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(t){var e,i,a=this.options;this.ready&&!this.disabled&&(e=a.dragCrop&&t===N,i=a.movable&&t===Q,t=e||i?t:q,this.$dragBox.data("action",t).toggleClass(C,e).toggleClass(w,i),a.cropBoxMovable||this.$face.data("action",t).toggleClass(C,e).toggleClass(w,i))}}),t.extend(d.prototype,nt),d.DEFAULTS={aspectRatio:NaN,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,mouseWheelZoom:!0,wheelZoomRatio:.1,touchDragZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},d.setDefaults=function(e){t.extend(d.DEFAULTS,e)},d.TEMPLATE='<div class="cropper-container"><div class="cropper-canvas"></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',d.other=t.fn.cropper,t.fn.cropper=function(e){var s,n=a(arguments,1);return this.each(function(){var i,a=t(this),o=a.data(m);if(!o){if(/destroy/.test(e))return;a.data(m,o=new d(this,e))}"string"==typeof e&&t.isFunction(i=o[e])&&(s=i.apply(o,n))}),i(s)?this:s},t.fn.cropper.Constructor=d,t.fn.cropper.setDefaults=d.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=d.other,this}});var ILabCrop=function(t,e){this.settings=e,this.modalContainer=t("#ilabm-container-"+e.modal_id),this.cropper=this.modalContainer.find(".ilabc-cropper"),this.cropperData={},this.modal_id=e.modal_id;var i,a=this,s=!1;this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:this.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){console.log(t),a.bindUI(t)})}}),t(window).resize(function(){s||(data=a.cropper.cropper("getData"),a.settings.prev_crop_x=data.x,a.settings.prev_crop_y=data.y,a.settings.prev_crop_width=data.width,a.settings.prev_crop_height=data.height),s=!0,a.updatePreviewWidth(),clearTimeout(i),i=setTimeout(a._resized,250)}),this.modalContainer.find(".ilabc-button-crop").on("click",function(t){return t.preventDefault(),a.crop(),!1}),this._resized=function(){a.bindUI(a.settings),s=!1},this.updatePreviewWidth=function(){var t=this.modalContainer.find(".ilab-crop-preview-title").width();this.modalContainer.find(".ilab-crop-preview").css({height:t/a.settings.aspect_ratio+"px",width:t+"px"})},this.bindUI=function(t){this.settings=t,this.cropper.cropper("destroy"),this.cropper.off("built.cropper"),t.hasOwnProperty("cropped_src")&&null!=t.cropped_src&&this.modalContainer.find(".ilab-current-crop-img").attr("src",t.cropped_src),t.hasOwnProperty("size_title")&&null!=t.size_title&&this.modalContainer.find(".ilabc-crop-size-title").text("Current "+t.size_title+" ("+t.min_width+" x "+t.min_height+")"),"undefined"!=typeof t.aspect_ratio&&(this.updatePreviewWidth(),"undefined"!=typeof t.prev_crop_x&&null!=t.prev_crop_x&&(this.cropperData={x:t.prev_crop_x,y:t.prev_crop_y,width:t.prev_crop_width,height:t.prev_crop_height},console.log(this.cropperData)),this.cropper.on("built.cropper",function(){a.updatePreviewWidth()}).on("crop.cropper",function(t){}).cropper({aspectRatio:t.aspect_ratio,minWidth:t.min_width,minHeight:t.min_height,modal:!0,zoomable:!1,mouseWheelZoom:!1,dragCrop:!1,autoCropArea:1,movable:!1,data:this.cropperData,checkImageOrigin:!1,responsive:!0,preview:"#ilabm-container-"+this.modal_id+" .ilab-crop-preview"}))},this.crop=function(){var t=this;this.displayStatus("Saving crop ...");var e=this.cropper.cropper("getData");e.action="ilab_perform_crop",e.post=this.settings.image_id,e.size=this.settings.size,jQuery.post(ajaxurl,e,function(e){console.log(e),"ok"==e.status?(t.modalContainer.find(".ilab-current-crop-img").one("load",function(){t.hideStatus()}),t.modalContainer.find(".ilab-current-crop-img").attr("src",e.src)):t.hideStatus()})},this.displayStatus=function(t){a.modalContainer.find(".ilabm-status-label").text(t),a.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){a.modalContainer.find(".ilabm-status-container").addClass("is-hidden")},this.bindUI(e)},ImgixComponents=function(){var t=function(t){var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return e[t>>4&15]+e[15&t]};return{utilities:{byteToHex:t}}}();!function(t){t.fn.imgixLabel=function(e){var i=t.extend({},e);return this.each(function(){var e,a=t(this),s=0,n=t('<input type="text" class="imgix-label-editor is-hidden" pattern="[0-9-]+">');a.parent().append(n),n.on("keydown",function(t){if(27==t.keyCode)n.off("blur"),n.off("input"),n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(s),a.text(s);else if(13==t.keyCode){n.off("blur"),n.off("input");var e=parseInt(n.val());n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}else if(38==t.keyCode){var e=parseInt(n.val());e++,n.val(e),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}else{if(40!=t.keyCode)return t.keyCode<57?!0:t.keyCode>90&&t.keyCode<105?!0:109==t.keyCode?!0:t.metaKey?!0:(t.preventDefault(),!1);var e=parseInt(n.val());e--,n.val(e),i.hasOwnProperty("changed")&&i.changed(e),a.text(e)}}),a.on("click",function(t){return t.preventDefault(),n.on("input",function(){var t=parseInt(n.val());i.hasOwnProperty("changed")&&(clearTimeout(e),e=setTimeout(function(){i.changed(t)},500)),a.text(t)}),n.on("blur",function(){var t=parseInt(n.val());n.addClass("is-hidden"),i.hasOwnProperty("changed")&&i.changed(t),a.text(t)}),s=i.hasOwnProperty("currentValue")?i.currentValue():0,n.val(s),n.removeClass("is-hidden"),n.select(),n.focus(),!1})})}}(jQuery),function(t){ImgixComponents.ImgixSlider=function(t,e){this.delegate=t,this.container=e,this.valueLabel=e.find(".imgix-param-title-right > h3"),this.slider=e.find(".imgix-param"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param");var i=this;this.container.find(".imgix-param-label").imgixLabel({currentValue:function(){return i.slider.val()},changed:function(t){t!=i.slider.val()&&(i.slider.val(t),i.slider.hide().show(0),i.delegate.preview())}}),this.resetButton.on("click",function(){i.reset()}),this.slider.on("input",function(){i.valueLabel.text(i.slider.val())}),this.slider.on("change",function(){i.valueLabel.text(i.slider.val()),i.delegate.preview()})},ImgixComponents.ImgixSlider.prototype.destroy=function(){this.slider.off("input"),this.slider.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixSlider.prototype.reset=function(t){var e;e=t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,this.valueLabel.text(e),this.slider.val(e),this.slider.hide().show(0),this.delegate.preview()},ImgixComponents.ImgixSlider.prototype.saveValue=function(t){return this.slider.val()!=this.defaultValue&&(t[this.param]=this.slider.val()),t}}(jQuery),function(t){ImgixComponents.ImgixColor=function(t,e){this.delegate=t,this.container=e,this.colorPicker=e.find(".imgix-param-color"),this.alphaSlider=e.find(".imgix-param-alpha"),this.type=e.data("param-type"),this.resetButton=e.find(".imgix-param-reset"),this.param=e.data("param"),this.defaultValue=e.data("default-value");var i=this;if("blend-color"==this.type){this.blendParam=e.data("blend-param"),this.blendSelect=e.find(".imgix-param-blend");var a=e.data("blend-value");this.blendSelect.val(a),this.blendSelect.on("change",function(){i.delegate.preview()})}this.colorPicker.wpColorPicker({palettes:!1,change:function(t,e){i.delegate.preview()}}),this.alphaSlider.on("change",function(){i.delegate.preview()}),this.resetButton.on("click",function(){i.reset()})},ImgixComponents.ImgixColor.prototype.destroy=function(){this.alphaSlider.off("change"),"blend-color"==this.type&&this.blendSelect.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixColor.prototype.reset=function(t){var e,i="none";if(t&&t.hasOwnProperty(this.blendParam)&&(i=t[this.blendParam]),e=t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,e=e.replace("#",""),8==e.length){var a=parseInt("0x"+e.substring(0,2))/255*100;e=e.substring(2),this.alphaSlider.val(Math.round(a)),this.alphaSlider.hide().show(0)}this.colorPicker.val("#"+e),this.colorPicker.wpColorPicker("color","#"+e),"blend-color"==this.type&&this.blendSelect.val(i),this.delegate.preview()},ImgixComponents.ImgixColor.prototype.saveValue=function(t){return this.alphaSlider.val()>0&&(t[this.param]="#"+ImgixComponents.utilities.byteToHex(Math.round(parseFloat(this.alphaSlider.val())/100*255))+this.colorPicker.val().replace("#",""),"blend-color"==this.type&&"none"!=this.blendSelect.val()&&(t[this.blendParam]=this.blendSelect.val())),t}}(jQuery),function(t){ImgixComponents.ImgixAlignment=function(e,i){this.delegate=e,this.container=i,this.alignmentParam=i.find(".imgix-param"),this.resetButton=i.find(".imgix-param-reset"),this.defaultValue=i.data("default-value"),this.param=i.data("param");var a=this;this.resetButton.on("click",function(){a.reset()}),i.find(".imgix-alignment-button").on("click",function(){var e=t(this);a.container.find(".imgix-alignment-button").each(function(){t(this).removeClass("selected-alignment")}),e.addClass("selected-alignment"),a.alignmentParam.val(e.data("param-value")),a.delegate.preview()})},ImgixComponents.ImgixAlignment.prototype.destroy=function(){this.resetButton.off("click"),this.container.find(".imgix-alignment-button").off("click")},ImgixComponents.ImgixAlignment.prototype.reset=function(e){var i;i=e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue,""==i&&(i=this.defaultValue),this.container.find(".imgix-alignment-button").each(function(){var e=t(this);e.data("param-value")==i?e.addClass("selected-alignment"):e.removeClass("selected-alignment")}),this.alignmentParam.val(i),this.delegate.preview()},ImgixComponents.ImgixAlignment.prototype.saveValue=function(t){return this.alignmentParam.val()!=this.defaultValue&&(t[this.param]=this.alignmentParam.val()),t}}(jQuery),function(t){ImgixComponents.ImgixMediaChooser=function(t,e){this.delegate=t,this.container=e,this.preview=e.find(".imgix-media-preview img"),this.mediaInput=e.find(".imgix-param"),this.selectButton=e.find(".imgix-media-button"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param"),this.uploader=wp.media({title:"Select Watermark",
button:{text:"Select Watermark"},multiple:!1});var i=this;this.resetButton.on("click",function(){i.reset()}),this.uploader.on("select",function(){attachment=i.uploader.state().get("selection").first().toJSON(),i.mediaInput.val(attachment.id),i.preview.attr("src",attachment.url),i.delegate.preview()}),this.selectButton.on("click",function(t){return t.preventDefault(),i.uploader.open(),!1})},ImgixComponents.ImgixMediaChooser.prototype.destroy=function(){this.selectButton.off("click"),this.uploader.off("select"),this.resetButton.off("click")},ImgixComponents.ImgixMediaChooser.prototype.reset=function(t){var e;t&&t.hasOwnProperty(this.param)?(e=t[this.param],this.mediaInput.val(e)):this.mediaInput.val(""),t&&t.hasOwnProperty(this.param+"_url")?this.preview.attr("src",t[this.param+"_url"]):(this.preview.removeAttr("src").replaceWith(this.preview.clone()),this.preview=this.container.find(".imgix-media-preview img")),this.delegate.preview()},ImgixComponents.ImgixMediaChooser.prototype.saveValue=function(t){var e=this.mediaInput.val();return e&&""!=e&&(t[this.param]=e),t}}(jQuery),function(t){ImgixComponents.ImgixPillbox=function(e,i){this.delegate=e,this.container=i,this.param=i.data("param"),this.values=i.data("param-values").split(","),this.buttons=i.find(".ilabm-pill"),this.inputs={};var a=this;this.buttons.each(function(){var e=t(this),i=e.data("param");a.inputs[i]=a.container.find("input[name='"+i+"']"),e.on("click",function(t){return t.preventDefault(),0==a.inputs[i].val()?(a.inputs[i].val(1),e.addClass("pill-selected")):(a.inputs[i].val(0),e.removeClass("pill-selected")),a.delegate.preview(),!1})})},ImgixComponents.ImgixPillbox.prototype.destroy=function(){this.buttons.off("click")},ImgixComponents.ImgixPillbox.prototype.reset=function(e){this.buttons.each(function(){t(this).removeClass("pill-selected")});var i=this;if(Object.keys(this.inputs).forEach(function(t,e){i.inputs[t].val(0)}),e&&e.hasOwnProperty(this.param)){var a=e[this.param].split(",");a.forEach(function(t,e){i.inputs[t].val(1),i.container.find("imgix-pill-"+t).addClass("pill-selected")})}this.delegate.preview()},ImgixComponents.ImgixPillbox.prototype.saveValue=function(t){var e=[],i=this;return Object.keys(this.inputs).forEach(function(t,a){1==i.inputs[t].val()&&e.push(t)}),e.length>0&&(t[this.param]=e.join(",")),t}}(jQuery);var ILabImgixPresets=function(t,e,i){this.delegate=e,this.container=i.find(".ilabm-bottom-bar"),this.presetSelect=this.container.find(".imgix-presets"),this.presetContainer=this.container.find(".imgix-preset-container"),this.presetDefaultCheckbox=this.container.find(".imgix-preset-make-default");var a=this;a.presetSelect.on("change",function(){if(0==a.presetSelect.val)return a.delegate.resetAll(),void a.presetDefaultCheckbox.prop("checked",!1);var t=a.delegate.settings.presets[a.presetSelect.val()];t.default_for==a.delegate.settings.size&&a.presetDefaultCheckbox.prop("checked",!0),a.delegate.bindPreset(t)}),this.container.find(".imgix-new-preset-button").on("click",function(){a.newPreset()}),this.container.find(".imgix-save-preset-button").on("click",function(){a.savePreset()}),this.container.find(".imgix-delete-preset-button").on("click",function(){a.deletePreset()}),this.init=function(){a.presetSelect.find("option").remove(),0==Object.keys(a.delegate.settings.presets).length?a.presetContainer.addClass("is-hidden"):(Object.keys(a.delegate.settings.presets).forEach(function(e,i){console.log(e),a.presetSelect.append(t("<option></option>").attr("value","0").text("None")),a.presetSelect.append(t("<option></option>").attr("value",e).text(a.delegate.settings.presets[e].title))}),a.presetContainer.removeClass("is-hidden"),a.presetSelect.val(a.delegate.settings.currentPreset))},this.clearSelected=function(){a.presetSelect.val(0),a.presetDefaultCheckbox.prop("checked",!1)},this.setCurrentPreset=function(t,e){e?a.presetDefaultCheckbox.prop("checked",!0):a.presetDefaultCheckbox.prop("checked",!1),a.presetSelect.val(t)},this.newPreset=function(){var t=prompt("New preset name");if(null!=t){a.delegate.displayStatus("Saving preset ...");var e={};e.name=t,a.presetDefaultCheckbox.is(":checked")&&(e.make_default=1),a.delegate.postAjax("ilab_imgix_new_preset",e,function(t){a.delegate.hideStatus(),"ok"==t.status&&(a.delegate.settings.currentPreset=t.currentPreset,a.delegate.settings.presets=t.presets,a.init())})}},this.savePreset=function(){if(null!=a.presetSelect.val()){a.delegate.displayStatus("Saving preset ...");var t={};t.key=a.presetSelect.val(),a.presetDefaultCheckbox.is(":checked")&&(t.make_default=1),a.delegate.postAjax("ilab_imgix_save_preset",t,function(t){a.delegate.hideStatus()})}},this.deletePreset=function(){if(null!=a.presetSelect.val()&&confirm("Are you sure you want to delete this preset?")){a.delegate.displayStatus("Delete preset ...");var t={};t.key=a.presetSelect.val(),a.delegate.postAjax("ilab_imgix_delete_preset",t,function(t){a.delegate.hideStatus(),"ok"==t.status&&(a.delegate.settings.currentPreset=t.currentPreset,a.delegate.settings.presets=t.presets,a.init(),a.delegate.bindUI(t))})}},this.init()};!function(t){t.fn.ilabSidebarTabs=function(e){var i=t.extend({},e),a=!1;return this.find(".ilabm-sidebar-tab").each(function(){var e=t(this),s=i.container.find("."+e.data("target"));a||(e.addClass("active-tab"),s.removeClass("is-hidden"),a=!0),e.on("click",function(a){return a.preventDefault(),i.container.find(".ilabm-sidebar-tab").each(function(){var e=t(this),a=i.container.find("."+e.data("target"));e.removeClass("active-tab"),a.addClass("is-hidden")}),e.addClass("active-tab"),s.removeClass("is-hidden"),!1})})}}(jQuery);var ILabImageEdit=function(t,e){function i(){a.displayStatus("Building preview ..."),a.waitModal.removeClass("is-hidden"),a.postAjax("ilab_imgix_preview",{},function(t){"ok"==t.status?(a.settings.debug&&console.log(t.src),a.previewImage.on("load",function(){a.waitModal.addClass("is-hidden"),a.hideStatus()}),a.previewImage.attr("src",t.src)):(a.waitModal.addClass("is-hidden"),a.hideStatus())})}console.log(e),this.previewTimeout=null,this.previewsSuspended=!1,this.parameters=[];var a=this;this.settings=e,this.modalContainer=t("#ilabm-container-"+e.modal_id),this.waitModal=this.modalContainer.find(".ilabm-preview-wait-modal"),this.previewImage=this.modalContainer.find(".imgix-preview-image"),this.presets=new ILabImgixPresets(t,this,this.modalContainer),this.modalContainer.find(".imgix-button-reset-all").on("click",function(){a.resetAll()}),this.modalContainer.find(".imgix-button-save-adjustments").on("click",function(){a.apply()}),this.modalContainer.find(".imgix-parameter").each(function(){var e=t(this),i=e.data("param-type");"slider"==i?a.parameters.push(new ImgixComponents.ImgixSlider(a,e)):"color"==i||"blend-color"==i?a.parameters.push(new ImgixComponents.ImgixColor(a,e)):"pillbox"==i?a.parameters.push(new ImgixComponents.ImgixPillbox(a,e)):"media-chooser"==i?a.parameters.push(new ImgixComponents.ImgixMediaChooser(a,e)):"alignment"==i&&a.parameters.push(new ImgixComponents.ImgixAlignment(a,e))}),this.modalContainer.on("click",".imgix-pill",function(){var e=t(this).data("param"),i=a.modalContainer.find("#imgix-param-"+e);1==i.val()?(i.val(0),t(this).removeClass("pill-selected")):(i.val(1),t(this).addClass("pill-selected")),a.preview()}),this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:a.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){console.log(t),a.bindUI(t)})}}),this.modalContainer.find(".ilabm-sidebar-tabs").ilabSidebarTabs({delegate:this,container:this.modalContainer}),this.postAjax=function(e,i,s){var n={};a.parameters.forEach(function(t,e){n=t.saveValue(n)}),console.log(n),i.image_id=a.settings.image_id,i.action=e,i.size=a.settings.size,i.settings=n,t.post(ajaxurl,i,s)},this.preview=function(){a.previewsSuspended||(ILabModal.makeDirty(),clearTimeout(a.previewTimeout),a.previewTimeout=setTimeout(i,500))},this.bindUI=function(t){if(t.hasOwnProperty("currentPreset")&&null!=t.currentPreset&&""!=t.currentPreset){var e=a.settings.presets[t.currentPreset];a.presets.setCurrentPreset(t.currentPreset,e.default_for==t.size)}else a.presets.clearSelected();a.previewsSuspended=!0,a.settings.size=t.size,a.settings.settings=t.settings;var i=function(){a.previewImage.off("load",i),a.parameters.forEach(function(e,i){e.reset(t.settings)}),a.previewsSuspended=!1,ILabModal.makeClean()};t.src?(a.previewImage.on("load",i),a.previewImage.attr("src",t.src)):i()},this.bindPreset=function(t){console.log(t),a.previewsSuspended=!0,a.settings.settings=t.settings,a.previewImage.off("load"),a.parameters.forEach(function(t,e){t.reset(a.settings.settings)}),a.previewsSuspended=!1,a.preview()},this.apply=function(){a.displayStatus("Saving adjustments ..."),a.postAjax("ilab_imgix_save",{},function(t){a.hideStatus(),ILabModal.makeClean()})},this.resetAll=function(){a.parameters.forEach(function(t,e){t.reset()})},this.displayStatus=function(t){a.modalContainer.find(".ilabm-status-label").text(t),a.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){a.modalContainer.find(".ilabm-status-container").addClass("is-hidden")}};
//# sourceMappingURL=ilab-media-tools.js.map
